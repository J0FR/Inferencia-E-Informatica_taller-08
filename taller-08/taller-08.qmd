---
title: "Taller 08"
subtitle: "Correlación, Regresión Lineal, Regresión múltiple"
author: Integrante
date: today
format: html
---

```{r}

library(readxl)
library(ggplot2)
library(report)
library(performance)
library(patchwork)
library(ggpmisc)
library(dplyr)

```

En **todos** los puntos del taller **debe** realizar todos los siguientes pasos:

Lea muy bien el enunciado y la pregunta asociada, además, asegúrese de entender lo que se pide. En **todos** los puntos del taller **debe** realizar todos los siguientes pasos:

i.  De acuerdo a la descripción del estudio, formular una pregunta de investigación con sus respectivas hipótesis y predicciones.
ii. Identificar e indicar cuál es la variable dependiente y cuál la independiente y explique porqué.
iii. Evaluar la normalidad de las variables que lo requieran.
iv. Escoger el análisis estadístico correcto.
v.  Interprete sus resultados **incluyendo gráficas**. Incluya el Valor-P, valor observado del estadístico de prueba, alfa escogido, coeficiente de determinación ($R^2$) o coeficiente de correlación ($r$ y $r^2$), porcentaje explicado y porcentaje no explicado por el modelo. Discutir los resultados.

### 1. Relación en variables de cocodrilos \[1.66 puntos\]

\*\* En el archivo `Cocodrilos.xlxs` se presentan los datos crudos de un estudio donde se pretendía medir si existe alguna relación entre el tamaño del huevo (en mm) con el tamaño de la nidada (promedio de los huevos en la puesta) en el Yacaré Overo (*Caiman latirostris*). Realice el respectivo análisis estadístico y discuta las implicaciones biológicas de este estudio. Realice el gráfico correspondiente.

```{r}

cocodrilos <- read_excel("Cocodrilos.xlsx", sheet = 1)
cocodrilos$ClutchS <- as.numeric(cocodrilos$ClutchS)
cocodrilos$egg_size <- as.numeric(cocodrilos$egg_size)

cocodrilos

```

i.  De acuerdo a la descripción del estudio, formular una pregunta de investigación con sus respectivas hipótesis y predicciones.

```{r}

# Pregunta de investigación: ¿Existe una relación entre el tamaño del huevo y el tamaño de la nidada de los Caimanes latirostris?

# Hipótesis nula: No existe una relación entre el tamaño del huevo y el tamaño de la nidada (el coeficiente de correlacion es cero).
# Hipótesis alterna: Existe una relación entre el tamaño del huevo y el tamaño de la nidada (el coeficiente de correlacion es diferente a cero).

# Predicciones: Si existe una relación entre el tamaño del huevo y el tamaño de la nidada, entonces se espera que a mayor tamaño del huevo, mayor tamaño de la nidada. Si no existe una relación, entonces no se espera que haya una relación entre el tamaño del huevo y el tamaño de la nidada.

```

ii. Identificar e indicar cuál es la variable dependiente y cuál la independiente y explique porqué.

```{r}

# Variable dependiente: Tamaño de la nidada (ClutchS)
# Variable independiente: Tamaño del huevo (egg_size)

```

iii. Evaluar la normalidad y linealidad.

```{r}

# Verificamos asumptions de coeficiente de correlacion de Pearson
  # X and Y display a linear tendency
ggplot(cocodrilos, 
  aes(
      x = egg_size, 
      y = ClutchS)
      ) +
    geom_point(size = 2, alpha = 0.6) +
    labs(
        title = "Relación entre tamaño del huevo y tamaño de la nidada en Caimanes latirostris",
        x = "Tamaño del huevo (mm)",
        y = "Tamaño de la nidada (promedio de huevos)"
    ) +
    geom_smooth(method = "lm")
    # Visualmente podemos concluir que hay una tendencia lineal

  # X and Y display normal distribution
  # Evaluamos normalidad con Test de Shapiro-Wilk
    # Hipotesis nula: Los datos siguen una distribucion normal
    # Hipotesis alternativa: Los datos no siguen una distribuion normal
shapiro.test(cocodrilos$ClutchS)
shapiro.test(cocodrilos$egg_size)
      # Se concluye que los datos son normales para las variables ClutchS y egg_size

```

iv. Escoger el análisis estadístico correcto.

```{r}

# Escogemos hacer coeficiente de correlacion de Pearson
  # Hipotesis nula: No existe correlacion
  # Hipotesis alternativa: Existe correlacion
cor.test(cocodrilos$egg_size, cocodrilos$ClutchS, method = "pearson")

# Dado que el valor de p es menor a 0.05, rechazamos la hipotesis nula y concluimos que existe una correlacion entre el tamaño del huevo y el tamaño de la nidada.

```

v.  Interprete sus resultados **incluyendo gráficas**. Incluya el Valor-P, valor observado del estadístico de prueba, alfa escogido, coeficiente de determinación ($R^2$) o coeficiente de correlación ($r$ y $r^2$), porcentaje explicado y porcentaje no explicado por el modelo. Discutir los resultados.

```{r}

ggplot(cocodrilos, 
  aes(
      x = egg_size, 
      y = ClutchS)
      ) +
    geom_point(size = 2, alpha = 0.6) +
    labs(
        title = "Relación entre tamaño corporal y peso de la rana picuda",
        x = "Tamaño corporal (cm)",
        y = "Peso (g)"
    ) +
    geom_smooth(method = "lm") +
    stat_poly_eq(use_label(
      c("eq", "R2", "F", "p.value")
    ))

# Se concluye que hay una correlacion negativa entre el tamaño del huevo y el tamaño de la nidada. A mayor tamaño del huevo, menor tamaño de la nidada. El coeficiente de correlacion es de -0.7293243.

```

### 2. Efecto de locomoción en anfibios \[1.66 puntos\]

Usted quiere saber qué factores de la Rana Picuda, *Leptodactylus fuscus*, se encuentran asociadas al desempeño locomotor. Así mismo, tiene interés en estudiar si el tamaño corporal tiene relación con el peso. Los datos obtenidos se encuentran en la base de datos `costos.txt`.

```{r}

costos <- read.table("costos.txt", header = TRUE)

costos

```

i.  De acuerdo a la descripción del estudio, formular una pregunta de investigación con sus respectivas hipótesis y predicciones.

```{r}

# Pregunta de investigación: 1) ¿Qué factores de la Rana Picuda, Leptodactylus fuscus, se encuentran asociadas al desempeño locomotor? 2) ¿El tamaño corporal tiene relación con el peso?

# 1)
# Hipótesis nula: No existe una relación entre los factores evaluados y el desempeño locomotor de la rana picuda.
# Hipótesis alterna: Existe una relación entre los factores evaluados y el desempeño locomotor de la rana picuda.

# 2)
# Hipótesis nula: No existe una relación entre el tamaño corporal y el peso de la rana picuda.
# Hipótesis alterna: Existe una relación entre el tamaño corporal y el peso de la rana picuda.

# Predicciones 1: Si existe una relación entre los factores evaluados y el desempeño locomotor de la rana picuda, entonces se espera que a mayor valor de los factores evaluados, mayor desempeño locomotor. Si no existe una relación, entonces no se espera que haya una relación entre los factores evaluados y el desempeño locomotor de la rana picuda.

# Predicciones 2: Si existe una relación entre el tamaño corporal y el peso de la rana picuda, entonces se espera que a mayor tamaño corporal, mayor peso. Si no existe una relación, entonces no se espera que haya una relación entre el tamaño corporal y el peso.

```

ii. Identificar e indicar cuál es la variable dependiente y cuál la independiente y explique porqué.

```{r}

# Variable dependiente: peso_g
# Variable independiente: svl_cm

```

iii. Evaluar la normalidad y linealidad.

```{r}

# Verificamos asumptions de coeficiente de correlacion de Pearson
  # X and Y display a linear tendency
ggplot(costos, 
  aes(
      x = svl_cm, 
      y = peso_g)
      ) +
    geom_point(size = 2, alpha = 0.6) +
    labs(
        title = "Relación entre tamaño corporal y peso de la rana picuda",
        x = "Tamaño corporal (cm)",
        y = "Peso (g)"
    ) +
    geom_smooth(method = "lm")
    # Visualmente podemos concluir que hay una tendencia lineal

  # X and Y display normal distribution
  # Evaluamos normalidad con Test de Shapiro-Wilk
    # Hipotesis nula: Los datos siguen una distribucion normal
    # Hipotesis alternativa: Los datos no siguen una distribuion normal
shapiro.test(costos$svl_cm)
shapiro.test(costos$peso_g)
shapiro.test(costos$velmax)
shapiro.test(costos$Reservas_energeticas)
      # Se concluye que los datos son normales 

```

iv. Escoger el análisis estadístico correcto.

```{r}

# Realizaremos una regresion lineal multiple
  # Hipotesis nula: No existe correlacion
  # Hipotesis alternativa: Existe correlacion
modelo <- lm(velmax ~ svl_cm * peso_g * Reservas_energeticas, data = costos)

performance::check_model(modelo, check = "linearity")
performance::check_normality(modelo)
performance::check_heteroskedasticity(modelo)
# Se cumplen los supuestos de los residuos homecedasticidad. Sin embargo, no se cumple el supuesto de normalidad, ni linealidad de los residuos por lo que el modelo puede que no sea el mejor.

summary(modelo)

report::report(modelo)

    # Ninguno de los factores/variables evaluados se encuentran asociados al desempeño locomotor de la rana picuda dado de los soportados por los resulatdos del reporte del modelo (Ninguno es estadisticamente significativo). Ademas, en el summary se puede evidenciar que ningun p value es menor a 0.05, lo que nos indica que las variables no son estadisticamente significativas.

# Escogemos hacer coeficiente de correlacion de Pearson
  # Hipotesis nula: No existe correlacion
  # Hipotesis alternativa: Existe correlacion
cor.test(costos$peso_g, costos$svl_cm, method = "pearson")

# si hay correlacion entre el tamaño corporal y el peso de la rana picuda. Evidenciado del coeficiente de correlacion de Pearson en el que se encontro una correlacion positiva de 0.7477 y un p-value de 1.02e-09 que indica que se rechaza la hipotesis nula y por ende existe una correlacion entre el tamaño corporal y el peso de la rana picuda.

```

v.  Interprete sus resultados **incluyendo gráficas**. Incluya el Valor-P, valor observado del estadístico de prueba, alfa escogido, coeficiente de determinación ($R^2$) o coeficiente de correlación ($r$ y $r^2$), porcentaje explicado y porcentaje no explicado por el modelo. Discutir los resultados.

```{r}

ggplot(costos, 
  aes(
      x = svl_cm, 
      y = peso_g)
      ) +
    geom_point(size = 2, alpha = 0.6) +
    labs(
        title = "Relación entre tamaño corporal y peso de la rana picuda",
        x = "Tamaño corporal (cm)",
        y = "Peso (g)"
    ) +
    geom_smooth(method = "lm") +
    stat_poly_eq(use_label(
      c("eq", "R2", "F", "p.value")
    ))

# Conclucion de la regresion lineal multiple: Ninguno de los factores/variables evaluados se encuentran asociados al desempeño locomotor de la rana picuda dado de los soportados por los resulatdos del reporte del modelo (Ninguno es estadisticamente significativo). Ademas, en el summary se puede evidenciar que ningun p value es menor a 0.05, lo que nos indica que las variables no son estadisticamente significativas.

# Conclucion de la correlacion de Pearson: si hay correlacion entre el tamaño corporal y el peso de la rana picuda. Evidenciado del coeficiente de correlacion de Pearson en el que se encontro una correlacion positiva de 0.7477 y un p-value de 1.02e-09 que indica que se rechaza la hipotesis nula y por ende existe una correlacion entre el tamaño corporal y el peso de la rana picuda.

```

### 3. Efecto de múltiples variables en incendios forestales \[1.66 puntos\]

El conjunto de datos `forestfires.csv` [Cortez & Morais, 2007](https://repositorium.sdum.uminho.pt/bitstream/1822/8039/1/fires.pdf) contiene información de los incendios ocurridos en el parque natural Montesinho, Portugal entre los años 2000 y 2003. Información más detallada de las variables de este conjunto de datos se puede encontrar en [Forest Fires Data Set](https://archive.ics.uci.edu/ml/datasets/Forest+Fires).

```{r}

forestfires <- read.csv("forestfires.csv")
forestfires <- forestfires |>
  mutate(month = case_when(
    month == "jan" ~ 1,
    month == "feb" ~ 2,
    month == "mar" ~ 3,
    month == "apr" ~ 4,
    month == "may" ~ 5,
    month == "jun" ~ 6,
    month == "jul" ~ 7,
    month == "aug" ~ 8,
    month == "sep" ~ 9,
    month == "oct" ~ 10,
    month == "nov" ~ 11,
    month == "dec" ~ 12
  ))

forestfires

colnames(forestfires)

```

i.  De acuerdo a la descripción del estudio, formular una pregunta de investigación con sus respectivas hipótesis y predicciones.

```{r}

# Pregunta de investigación: ¿Qué factores se encuentran asociados al área total quemada por los incendios forestales en el parque natural Montesinho, Portugal?

# Hipótesis nula: No existe una relación entre el área total quemada por los incendios forestales y los factores evaluados.
# Hipótesis alterna: Existe una relación entre el área total quemada por los incendios forestales y los factores evaluados.

# Predicciones: Si existe una relación entre el área total quemada por los incendios forestales y los factores evaluados, entonces se espera que a mayor valor de los factores evaluados, mayor área total quemada. Si no existe una relación, entonces no se espera que haya una relación entre el área total quemada por los incendios forestales y los factores evaluados.

```

ii. Identificar e indicar cuál es la variable dependiente y cuál la independiente y explique porqué.

```{r}

# Variable dependiente: area
# Variables independientes: Month, FFMC, DMC, DC, ISI, temp, RH, Wind, Rain

```

iii. Evaluar la normalidad de las variables que lo requieran.

```{r}

# Verificar normalidad de las variables
shapiro.test(forestfires$area)
shapiro.test(forestfires$month)
shapiro.test(forestfires$FFMC)
shapiro.test(forestfires$DMC)
shapiro.test(forestfires$DC)
shapiro.test(forestfires$ISI)
shapiro.test(forestfires$temp)
shapiro.test(forestfires$RH)
shapiro.test(forestfires$wind)
shapiro.test(forestfires$rain)

# Se concluye que las variables cumplen normalidad

```

iv. Escoger el análisis estadístico correcto.

```{r}

# Realizaremos una regresion lineal multiple
  # Hipotesis nula: No existe correlacion
  # Hipotesis alternativa: Existe correlacion
modelo_2 <- lm(area ~ month * FFMC * DMC * DC + ISI * temp * RH * wind * rain, data = forestfires)

performance::check_model(modelo_2, check = "linearity")
performance::check_normality(modelo_2)
performance::check_heteroskedasticity(modelo_2)
# Se cumplen los supuestos de los residuos linealidad. Sin embargo, no se cumple el supuesto de normalidad, ni Heterosteasidad de los residuos por lo que el modelo puede que no sea el mejor.

summary(modelo_2)

report::report(modelo_2)

# Se encontra que ninguna de las variables evaluadas se encuentran asociadas al área total quemada por los incendios forestales en el parque natural Montesinho, Portugal. Ninguna de las variables evaluadas es estadisticamente significativa. Ademas, en el summary se puede evidenciar que ningun p value es menor a 0.05, lo que nos indica que las variables no son estadisticamente significativas.

```

v.  Interprete sus resultados **incluyendo gráficas**. Incluya el Valor-P, valor observado del estadístico de prueba, alfa escogido, coeficiente de determinación ($R^2$) o coeficiente de correlación ($r$ y $r^2$), porcentaje explicado y porcentaje no explicado por el modelo. Discutir los resultados.

```{r}

ggplot(forestfires, 
  aes(
      x = DMC, 
      y = area)
      ) +
    geom_point(size = 2, alpha = 0.6) +
    labs(
        title = "Relación entre DMC y area total quemada por los incendios forestales",
        x = "DMC",
        y = "Area total quemada"
    ) +
    geom_smooth(method = "lm") +
    stat_poly_eq(use_label(
      c("eq", "R2", "F", "p.value")
    ))

ggplot(forestfires, 
  aes(
      x = DC, 
      y = area)
      ) +
    geom_point(size = 2, alpha = 0.6) +
    labs(
        title = "Relación entre DMC y area total quemada por los incendios forestales",
        x = "DMC",
        y = "Area total quemada"
    ) +
    geom_smooth(method = "lm") +
    stat_poly_eq(use_label(
      c("eq", "R2", "F", "p.value")
    ))

# Se encontra que ninguna de las variables evaluadas se encuentran asociadas al área total quemada por los incendios forestales en el parque natural Montesinho, Portugal. Ninguna de las variables evaluadas es estadisticamente significativa. Ademas, en el summary se puede evidenciar que ningun p value es menor a 0.05, lo que nos indica que las variables no son estadisticamente significativas.

```

**a.** **\[0.83 puntos\]** Determine el efecto del índice FFMC y el mes (de forma conjunta) sobre el área total quemada por el incendio.

```{r}

summary(modelo_2)

#                         Estimate Std. Error t value Pr(>|t|)
# month:FFMC            -8.089e-02  1.081e+00  -0.075    0.940

# El efecto del es de -0.08089, lo que indica que a medida que aumenta el índice FFMC, el área quemada disminuye en promedio 0.08089 unidades. Sin embargo, este efecto no es significativo (valor p = 0.940), por lo que no se puede concluir que haya una relación entre el índice FFMC y el área quemada.

```

**b.** **\[0.83 puntos\]** Determine el efecto de los índices FFMC, DMC e ISI el área total quemada por el incendio.

```{r}

summary(modelo_2)

#                         Estimate Std. Error t value Pr(>|t|)
# FFMC                   1.738e+00  4.491e+00   0.387    0.699
# DMC                    6.893e-01  1.709e+01   0.040    0.968
# ISI                    1.361e+01  1.950e+01   0.698    0.486

# Los índices FFMC, DMC e ISI no muestran efectos significativos sobre el área total quemada según el análisis realizado, ya que todos sus valores p son mayores a 0.05. Aunque los coeficientes estiman un posible incremento del área quemada con el aumento de estos índices, la alta incertidumbre indica que estos efectos no son concluyentes y podrían deberse al azar. Por lo tanto, no se puede afirmar que FFMC, DMC e ISI tengan una relación estadísticamente significativa con la cantidad de área afectada por los incendios.

```
